<h2 mat-dialog-title>Report Incident</h2>

<div mat-dialog-content class="form-container">
  <form #incidentForm="ngForm">

    <div class="form-row">
      <div>
        <label class="field-label">Latitude</label>
        <mat-form-field class="full-width" appearance="outline">
          <input
            matInput
            type="number"
            name="latitude"
            [(ngModel)]="incident.location.latitude"
            placeholder="Latitude"
            required
          />
        </mat-form-field>
      </div>

      <div>
        <label class="field-label">Longitude</label>
        <mat-form-field class="full-width" appearance="outline">
          <input
            matInput
            type="number"
            name="longitude"
            [(ngModel)]="incident.location.longitude"
            placeholder="Longitude"
            required
          />
        </mat-form-field>
      </div>
    </div>

    <div class="form-row">
      <div>
        <label class="field-label">Incident Type</label>
        <mat-form-field class="full-width" appearance="outline">
          <mat-select
            name="type"
            [(ngModel)]="incident.type"
            (selectionChange)="onTypeChange()"
            placeholder="Type"
            required
          >
            <mat-option value="FIRE">Fire</mat-option>
            <mat-option value="FLOOD">Flood</mat-option>
            <mat-option value="ACCIDENT">Accident</mat-option>
            <mat-option value="CRIME">Crime</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div>
        <label class="field-label">Subtype</label>
        <mat-form-field class="full-width" appearance="outline">
          <mat-select
            name="subtype"
            [(ngModel)]="incident.subtype"
            placeholder="Subtype"
          >
            <mat-option
              *ngFor="let sub of subtypesByType[incident.type]"
              [value]="sub"
            >
              {{ subtypeLabels[sub] }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="form-row">
      <div>
        <label class="field-label">Address</label>
        <mat-form-field class="full-width" appearance="outline">
          <input
            matInput
            type="text"
            name="address"
            [(ngModel)]="incident.location.address"
            placeholder="Address"
            required
          />
        </mat-form-field>
      </div>

      <div>
        <label class="field-label">Image</label>
        <div class="image-preview" *ngIf="selectedImage">
          <img
            [src]="selectedImagePreview"
            alt="Incident image"
            style="max-width: 200px; border-radius: 8px; margin-bottom: 8px;"
          />
        </div>
        <div
          class="image-dropzone"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)"
        >
          <p *ngIf="!selectedImage">Drag & drop image here or click to select</p>
          <p *ngIf="selectedImage">Selected: {{ selectedImage.name }}</p>
          <input
            type="file"
            class="file-input"
            (change)="onFileSelected($event)"
            accept="image/*"
          />
        </div>
      </div>
    </div>

    <div class="form-row">
      <div>
        <label class="field-label">Description</label>
        <mat-form-field class="full-width" appearance="outline">
          <textarea
            matInput
            rows="3"
            name="description"
            [(ngModel)]="incident.description"
            placeholder="Description"
            required
          ></textarea>
        </mat-form-field>
      </div>
    </div>

  </form>
</div>

<div mat-dialog-actions class="dialog-actions">
  <button mat-stroked-button color="warn" (click)="cancel()">Cancel</button>
  <button
    mat-raised-button
    color="primary"
    [disabled]="!incidentForm.valid"
    (click)="save()"
  >
    Save
  </button>
</div>
